# Apache SSL Configuration for Quiz Server
# This configuration sets up Apache as a reverse proxy with SSL/TLS for HTTP/HTTPS
# Place this file in your Apache configuration directory or include it in httpd.conf

# Enable required modules (uncomment if not already enabled)
# LoadModule ssl_module modules/mod_ssl.so
# LoadModule proxy_module modules/mod_proxy.so
# LoadModule proxy_http_module modules/mod_proxy_http.so
# LoadModule headers_module modules/mod_headers.so
# LoadModule rewrite_module modules/mod_rewrite.so

# Listen on HTTPS port
Listen 443 https

# SSL Configuration
<VirtualHost *:443>
    ServerName quiz.example.com
    # Change to your domain or IP address
    
    # SSL Certificate Configuration
    SSLEngine on
    SSLCertificateFile "D:/0)Projects/fatomaa/Live-Quiz-Server/ssl/server.crt"
    SSLCertificateKeyFile "D:/0)Projects/fatomaa/Live-Quiz-Server/ssl/server.key"
    # For production, you may want to include certificate chain
    # SSLCertificateChainFile /path/to/ssl/chain.crt
    
    # SSL Protocol Configuration
    SSLProtocol all -SSLv2 -SSLv3
    SSLCipherSuite HIGH:!aNULL:!MD5
    SSLHonorCipherOrder on
    
    # Proxy Configuration - Reverse Proxy to Python HTTP Server
    ProxyPreserveHost On
    ProxyRequests Off
    
    # Proxy all HTTP requests to the Python server
    ProxyPass / http://127.0.0.1:8080/
    ProxyPassReverse / http://127.0.0.1:8080/
    
    # For Server-Sent Events (SSE) support
    ProxyPass /api/quiz/stream http://127.0.0.1:8080/api/quiz/stream
    ProxyPassReverse /api/quiz/stream http://127.0.0.1:8080/api/quiz/stream
    
    # Set headers for proper proxy behavior
    ProxyPassReverse / http://127.0.0.1:8080/
    RequestHeader set X-Forwarded-Proto "https"
    RequestHeader set X-Forwarded-Port "443"
    
    # Logging
    ErrorLog logs/quiz_ssl_error.log
    CustomLog logs/quiz_ssl_access.log combined
    
    # Security Headers
    Header always set Strict-Transport-Security "max-age=63072000; includeSubDomains; preload"
    Header always set X-Frame-Options DENY
    Header always set X-Content-Type-Options nosniff
    Header always set X-XSS-Protection "1; mode=block"
</VirtualHost>

# Optional: Redirect HTTP to HTTPS
<VirtualHost *:80>
    ServerName quiz.example.com
    # Change to your domain or IP address
    
    RewriteEngine On
    RewriteCond %{HTTPS} off
    RewriteRule ^(.*)$ https://%{HTTP_HOST}$1 [R=301,L]
</VirtualHost>

# Note: This configuration proxies HTTP/HTTPS requests to the Python FastAPI server.
# The Python server should be running on http://127.0.0.1:8080
# Apache handles SSL/TLS termination, and forwards plain HTTP to the backend.


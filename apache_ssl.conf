# Apache SSL Configuration for Quiz Server
# This configuration sets up Apache as a reverse proxy with SSL/TLS
# Place this file in your Apache configuration directory or include it in httpd.conf

# Enable required modules (uncomment if not already enabled)
# LoadModule ssl_module modules/mod_ssl.so
# LoadModule proxy_module modules/mod_proxy.so
# LoadModule proxy_http_module modules/mod_proxy_http.so
# LoadModule proxy_wstunnel_module modules/mod_proxy_wstunnel.so

# Listen on HTTPS port
Listen 443 https

# SSL Configuration
<VirtualHost *:443>
    ServerName quiz.example.com
    # Change to your domain or IP address
    
    # SSL Certificate Configuration
    SSLEngine on
    SSLCertificateFile "D:/0)Projects/fatomaa/Live-Quiz-Server/ssl/server.crt"
    SSLCertificateKeyFile "D:/0)Projects/fatomaa/Live-Quiz-Server/ssl/server.key"
    # For production, you may want to include certificate chain
    # SSLCertificateChainFile /path/to/ssl/chain.crt
    
    # SSL Protocol Configuration
    SSLProtocol all -SSLv2 -SSLv3
    SSLCipherSuite HIGH:!aNULL:!MD5
    SSLHonorCipherOrder on
    
    # Proxy Configuration - Reverse Proxy to Python WebSocket Server
    ProxyPreserveHost On
    ProxyRequests Off
    
    # WebSocket proxy configuration
    # The Python WebSocket server should be listening on ws://127.0.0.1:8080
    RewriteEngine on
    RewriteCond %{HTTP:Upgrade} websocket [NC]
    RewriteCond %{HTTP:Connection} upgrade [NC]
    RewriteRule ^/?(.*) "ws://127.0.0.1:8080/$1" [P,L]
    
    # Fallback for non-WebSocket requests (if needed)
    ProxyPass / http://127.0.0.1:8080/
    ProxyPassReverse / http://127.0.0.1:8080/
    
    # Logging
    ErrorLog logs/quiz_ssl_error.log
    CustomLog logs/quiz_ssl_access.log combined
    
    # Security Headers
    Header always set Strict-Transport-Security "max-age=63072000; includeSubDomains; preload"
    Header always set X-Frame-Options DENY
    Header always set X-Content-Type-Options nosniff
</VirtualHost>

# Optional: Redirect HTTP to HTTPS
<VirtualHost *:80>
    ServerName quiz.example.com
    # Change to your domain or IP address
    
    RewriteEngine On
    RewriteCond %{HTTPS} off
    RewriteRule ^(.*)$ https://%{HTTP_HOST}$1 [R=301,L]
</VirtualHost>

# Note: For TCP proxying (if needed), you would need mod_proxy_connect
# However, Apache primarily works with HTTP/HTTPS protocols.
# For raw TCP proxy, consider using mod_proxy_connect or haproxy

